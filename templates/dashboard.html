{% extends "base.html" %}

{% block head %}
<title>Dashboard - QuickPay</title>
{% endblock %}

{% block body %}

<div class="container dashboard-page">
<header>
<h1>QuickPay</h1>
<a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
</header>

<div class="balance-container">
    <div class="balance-card">
        <h2>Welcome, {{ user.name }}</h2>
        <p class="balance-amount">${{ "{:,.2f}".format(user.balance) }}</p>
        <p class="balance-label">Current Balance</p>

        <!-- VERIFICATION STATUS BAR -->
        <div class="verification-status-bar status-{{ user.verification_status | lower }}">
            Verification Status:
            <strong>{{ user.verification_status }}</strong>
        </div>
        {% if user.verification_status == 'Unverified' %}
            <a href="{{ url_for('verify') }}" class="verify-link">Verify Account Now</a>
        {% elif user.verification_status == 'Submitted' %}
            <span class="verify-link-submitted">Review in Progress...</span>
        {% endif %}
        <!-- END VERIFICATION STATUS BAR -->

    </div>
</div>

<div class="dashboard-grid">

    <section class="payment-section">
        <h2>Send Money</h2>
        <!-- Payment Form -->
        <form action="{{ url_for('transfer') }}" method="post" id="transfer-form">
            <label for="receiver_id">Recipient:</label>
            <select name="receiver_id" id="receiver_id" required>
                <option value="" disabled selected>Select a user to pay</option>
                {% for other_user in other_users %}
                    <option value="{{ other_user.id }}">{{ other_user.name }} ({{ other_user.email }})</option>
                {% else %}
                    <option value="" disabled>No other users registered yet.</option>
                {% endfor %}
            </select>

            <label for="amount">Amount ($):</label>
            <input type="number" name="amount" id="amount" step="0.01" min="0.01" placeholder="e.g., 50.00" required>

            <input type="submit" value="Transfer Funds">
        </form>
    </section>

    <section class="history-section">
        <h2>Transaction History</h2>
        {% if history %}
            <table class="transaction-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Name</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in history %}
                        {% set is_sent = t.type == 'Sent' %}
                        <tr class="transaction-{{ t.type | lower }}">
                            <td data-label="Type"><span class="type-indicator type-{{ t.type | lower }}">{{ t.type }}</span></td>
                            <td data-label="Amount" class="amount-{{ t.type | lower }}">{{ "-" if is_sent else "+" }}${{ "{:,.2f}".format(t.amount) }}</td>
                            <td data-label="{{ 'To' if is_sent else 'From' }}">{{ t.receiver_name if is_sent else t.sender_name }}</td>
                            <td data-label="Date">{{ t.timestamp.split(' ')[0] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-history">No transactions yet.</p>
        {% endif %}
    </section>
</div>


</div>
{% endblock %}